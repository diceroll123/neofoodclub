name: Update Logit Values

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 1 * *"
  push:
    paths:
      - "automation/*"

concurrency:
  # since this runs on an interval this should be fine
  # but we want concurrency failures since we're doing commits
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}

jobs:
  update-logit:
    name: Update Logit Values
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run Docker
        run: |
          cd automation/
          docker build -t nfc_values .
          docker compose up
      - name: Commit and PR changes
        # success() ensures the previous job succeeds
        if: ${{ success() }}
        uses: peter-evans/create-pull-request@v6
        with:
          add-paths: |
            automation/**
          commit-message: "Autogenerated commit for logit update"
          body: |
            Update logit with latest data.
          branch: update/logit
          branch-suffix: timestamp
          title: "[Automated] Update logit values"
